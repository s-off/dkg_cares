---
title: "Rehabilitation nach Tumorerkrankungen: Sekundärdatenanalyse zur Rückkehr von Krebspatient:innen in den Beruf, 2010–2017"
author: "Johannes Soff"
date: "20 2 2022"
output:
  html_document: default
  word_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(haven)
library(tidyverse)
library(gt)
library(gtsummary)
library(labelled)
```

# Methode
## Datenbestandsbeschreibung
Für die vorliegende Analyse wurde der Scientific Use File (SUF) „Abgeschlossene Rehabilitationen 2010–2017“ der Deutschen Rentenversicherung verwendet. Der Datenbestand basiert auf der Reha-Statistik-Datenbasis-Verlaufserhebung nach § 13 Abs. 1 RSVwV und § 4 RSVwV der gesetzlichen Rentenversicherung und enthält personenbezogene Daten mit Angaben zu den Versicherten und deren anspruchsberechtigten Angehörigen.
Eingeschlossen sind Personen mit einem der folgenden Merkmale im Beobachtungszeitraum (2010–2017): mindestens eine abgeschlossene Rehabilitationsleistung, bewilligte Rente oder Zugehörigkeit zu einer bestimmten demografischen Kohorte (Tod vor oder im Alter von 75 Jahren oder Zugehörigkeit zu einem bestimmten Geburtsjahrgang).
Personen, deren Anträge auf Rehabilitation oder eine Rente endgültig abgelehnt wurden, sind ausgeschlossen. Für jedes Rehabilitations-, Renten- oder demografische Ereignis werden die einbezogenen Personen über einen Zeitraum von 8 Jahren beobachtet (mit geringfügigen Abweichungen, z.B. bei der Nachmeldung von Todesfällen sind Daten auch 9 Jahre nach dem ersten dokumentierten Ereignis verfügbar).
Der Datenbestand umfasst insgesamt eine disproportionale Zufallsstichprobe von 20% aller Versicherten (N ≈ 3,7 Millionen), wobei für die Analyse der angegebene Gewichtungsfaktor verwendet wurde, um von der Stichprobe auf die Zielpopulation zu schließen.

Da die DRV der Hauptzahler für Rehabilitationsleistungen Erwerbstätiger in Deutschland ist, liegt die Altersspanne der Teilnehmer in diesem Datensatz typischerweise zwischen 16 und 66 Jahren. Eine detaillierte Beschreibung des Datensatzes, einschließlich des Stichprobendesigns, ist der Website des Forschungsdatenzentrum der Rentenversicherung zu entnehmen: <https://www.eservice-drv.de/FdzPortalWeb/dispcontent.do?id=main_fdz_forschung_laengsb_archiv&chmenu=ispvwNavEntriesByHierarchy34>.

Aufgrund des Längsschnittdesigns mit Individualdaten von 2010–2017 ist der SUF eine geeignete Quelle für die Analyse der Auswirkungen und zeitlichen Trends von Rehabilitationsleistungen.

In einem ersten Schritt wurden Rehabilitationspatienten mit mit der Hauptdiagnose KHK oder ischämische Herzkrankheit (ICD10 I20.-I25.), die eine medizinische Rehabilitation abgeschlossen hatten (Phase II). Im nächsten Schritt haben wir die EBRP-III mit der unsere Studienpopulation. Die Teilnahme musste innerhalb von sechs Monaten nach Abschluss der Phase-II-Rehabilitation beginnen.


### Teilnehmer und Outcomes
Aus dem vollständigen Datensatz von 3,7 Millionen Versicherten wurden primär Daten über Leistungen zur medizinischen Rehabilitation für die Auswertung verwendet. Für diese etwa 2,2 Millionen Patienten wurden die folgenden Ein- und Ausschlusskriterien definiert.

### Einschlusskriterien
- Eingeschlossen wurden Patienten, die AUSWAHLKRITERIEN_EINSCHLUSS
- Dabei wurden Patienten ausgeschlossen, die AUSSCHLUSSKRITERIEN_AUSSCHKUSS X (n=...), Y (n=...), Z (n=...)
- Deskriptive Tabelle

```{r import and subset data, echo=FALSE}
# Import Data
MCB <- read_spss("input/SUFRSDLV17MCB.sav")
KOB <- read_spss("input/SUFRSDLV17KOB.sav")
BYB <- read_spss("input/SUFRSDLV17BYB.sav")

### Subset mit Cases, die im Berichtzeitraum eine medizinische Rehabilitation auf Grund einer Krebsdiagnose begonnen haben
  ## Es wird nur die erste Episode (erste Rehabilitation auf Grund einer Krebsdiagnose betrachtet)

cancer_CASES_MCB_KOB <- MCB %>% 
  filter(mcdggr == 26,                                  # Bewilligungsdiagnosengruppe: Neubildungen (ICD10-Nr. C00 - D48)
         mcdg1_icd %in% c(7:31),                        # 1. med. Entlassungsdiagnose ICD-10: C00-96
         mcmsat %in% c(31,32),                          # Bewilligte Maßnahmeart: Ca(Krebs)-Reha-Leistung nach ? 15 SGB VI oder nach ? 31 Abs. 1 Nr. 2 SGB VI
         mcpsgral %in% c(2,3),                          # Art des Versicherungs- bzw. Rentnerstatus: Pflichtversicherter, freiwillig Versicherter
         mcumdt == 2,                                   # Umfang der Datenmeldung medizinische Rehabilitation: Reha-Leistung beendet, Datensatz vollständig
         mceafo == 1,                                   # Entlassungsform: regulär
         mcwhb == 0) %>%                                # Ausschluss von Wiederholungsleistungen
  mutate(RehaStart = mcbemsj*12 + mcbemsm) %>%          # Erste Episode wird durch RehaStart (Beginn der medizinischen Reha-Leistung) identifiziert
  arrange(case, RehaStart) %>% 
  distinct(case, .keep_all = TRUE) %>%
  inner_join(KOB, by = "case") %>%                      # Zusammenführung von MCB- und KOB-Daten
  mutate(GBZeitpkt = gbja*12 + gbmo,                    # Alter in Monaten
         RTZeitpkt = rtbej*12 + rtbem,                  # Rentenbeginn in Monaten
         TDZeitpkt = tddtj*12 + tddtm,                  # Todeszeitpunkt in Monaten
         AlterRehaStart = RehaStart - GBZeitpkt,        # Alter in Monaten bei Beginn der ersten med. Reha
         ZeitRehaStartRente = case_when(                # Zeitraum zwischen Beginn der ersten med. Reha und dem Rentenbeginn in Monaten
           rtbej %in% c(1:9998) ~ RTZeitpkt - RehaStart),
         ZeitRehaStartTod = case_when(                  # Zeitraum zwischen Beginn der ersten med. Reha und dem Todeszeitpunkt in Monaten
           tddtj %in% c(1:9998) ~ TDZeitpkt - RehaStart),
         RTvorReha = if_else(
           ZeitRehaStartRente < 0, 1, 0)) %>%
  filter(!RTvorReha %in% c(1),                          # Keine Rente vor Beginn der ersten med. Reha
         AlterRehaStart %in% c(216:804),                # Alter zwischen 18 und 67
         tddtj != 1992)                                 # Ausschluss Artefakt mit Todesjahr 1992



### Erstellen/Bearbeiten der Variablen

CARES_rtw <- cancer_CASES_MCB_KOB %>% 
  mutate(
    Geschlecht = case_when(
      sex == 1 ~ "männlich",
      sex == 2 ~ "weiblich"),
    AlterRehaStart_Jahr = case_when(
      gbja > 0 ~ mcbemsj-gbja),
    Tod = if_else(
      tddtj > 0, 1, 0)
    ) %>%
  remove_value_labels(mcdg1_icd = c(1:6, 32:999)) # Entfernen der leeren Diagnoselabels für gtsummary Ausgabe - Behält nur die lables für mmcdg1_icd %in% c(7:31), siehe Subseterstellung


```

## Tabelle 1

### Datensatzbeschreibung

```{r pressure, echo=FALSE}
### Datensatzbeschreibung

CARES_rtw %>%
  select(Geschlecht,
         AlterRehaStart_Jahr,
         mcfmsd,
         mcdg1_icd,
         tlrt,
         ZeitRehaStartRente,
         Tod,
         ZeitRehaStartTod,
         mcaiufzt,
         mcleft_lb,
         mcleft_at,
         bd,
         sb,
         bb,
         mcahb,
         mcaqda,
         mcstbf,
         mcwhot_ostwest,
         mcwhot_skt,
         mcmsot_bland) %>% 
  mutate_at(vars("bd", "sb", "bb", "mcahb", "mcfmsd", "mcwhot_ostwest", "mcwhot_skt", "mcmsot_bland", "mcstbf", "mcaiufzt", "mcleft_lb", "mcleft_at", "mcdg1_icd", "tlrt"), haven::as_factor) %>%
  tbl_summary(
    by = Geschlecht,
    statistic = all_continuous() ~ "{mean} ({sd})",
    label = list(
      AlterRehaStart_Jahr ~ "Alter bei Beginn der ersten Rehabilitationsleistung",
      mcdg1_icd ~ "Medizinische Entlassungsdiagnose der Rehabilitation",
      ZeitRehaStartRente ~ "Zeitraum vom Beginn der ersten medizinischen Rehabilitation bis zum Rentenbeginn in Monaten",
      Tod ~ "Versterben im Beobachtungszeitraum",
      ZeitRehaStartTod ~ "Zeitraum vom Beginn der ersten medizinischen Rehabilitation bis zum Todeszeitpunkt in Monaten",
      mcaqda ~ "Zeitraum von der Antragstellung eines Antrags auf medizinische Rehabilitation bis zu seiner Bewilligung in Tagen"),
    digits = list(
      AlterRehaStart_Jahr ~ 1,
      ZeitRehaStartTod ~ 0),
    missing = "no") %>% 
  add_overall() %>% 
  modify_header(label = "**Variable**") %>% 
  bold_labels()
```

Variablenauswahl treffen
